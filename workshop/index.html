<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RTN16HE6HP"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RTN16HE6HP",{})</script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-RTN16HE6HP"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-RTN16HE6HP",{})</script><title data-react-helmet="true">Code Gen Workshop | Bee Travels</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Code Gen Workshop | Bee Travels"><meta data-react-helmet="true" name="description" content="About"><meta data-react-helmet="true" property="og:description" content="About"><meta data-react-helmet="true" property="og:url" content="https://bee-travels.github.io/workshop/"><link data-react-helmet="true" rel="shortcut icon" href="/img/faviconBee.ico"><link data-react-helmet="true" rel="canonical" href="https://bee-travels.github.io/workshop/"><link rel="stylesheet" href="/styles.e4f86489.css">
<link rel="preload" href="/styles.bd6c5aa5.js" as="script">
<link rel="preload" href="/runtime~main.358f0183.js" as="script">
<link rel="preload" href="/main.6428835f.js" as="script">
<link rel="preload" href="/1.f6070e50.js" as="script">
<link rel="preload" href="/2.156073dc.js" as="script">
<link rel="preload" href="/23.e9f77d1b.js" as="script">
<link rel="preload" href="/24.05bc3b70.js" as="script">
<link rel="preload" href="/a95e0901.d062a689.js" as="script">
<link rel="preload" href="/17896441.08175231.js" as="script">
<link rel="preload" href="/7b70a777.8f0ac477.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Bee-Travels"><strong class="navbar__title">Bee Travels</strong></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/workshop">Workshop</a></div><div class="navbar__items navbar__items--right"><a href="https://developer.ibm.com/?s=microservices" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">IBM Developer</a><a href="https://github.com/bee-travels" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Bee-Travels"><strong class="navbar__title">Bee Travels</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/workshop">Workshop</a></li><li class="menu__list-item"><a href="https://developer.ibm.com/?s=microservices" target="_blank" rel="noopener noreferrer" class="menu__link">IBM Developer</a></li><li class="menu__list-item"><a href="https://github.com/bee-travels" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/workshop/">Code Gen Workshop</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Code Gen Workshop</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="about"></a>About<a aria-hidden="true" tabindex="-1" class="hash-link" href="#about" title="Direct link to heading">#</a></h2><p>Bee Travels is a travel booking application that is composed of several mircoservices.
These microservices include: </p><ul><li>Hotel Microservice</li><li>Car Rental Microservice </li><li>Flight Microservice </li><li>Currency Exchange Microservice </li><li>UI Front End </li><li>UI Back End </li></ul><p>Each mircoservice can be run independently, or together to form the full service. Bee Travels can be used to search and book hotels, flights and car rentals for various destinations across the world.</p><p><img alt="img" src="/assets/images/wkshp1-c800455c1e343ab38e62cfbd44e6c899.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="overview"></a>Overview<a aria-hidden="true" tabindex="-1" class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>In this workshop we will be using the Node.js code generation service template to seemlesly create microservices in Node.js. We will be creating our own budgeting microservice using the Bee Travels Node hotel and car rental microservices to build a microservice that gives a list of hotel and car rental combinations for a location that fit into a given maximum budget. </p><p>Let&#x27;s get started! </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="prerequisites"></a>Prerequisites<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noopener noreferrer">Install Docker</a></li><li><a href="https://classic.yarnpkg.com/en/docs/install/" target="_blank" rel="noopener noreferrer">Install Yarn</a></li><li>Install Node Version 12.0.0 : <code>nvm install v12.0.0</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="getting-started-with-code-generation-node-template"></a>Getting Started with Code Generation Node Template<a aria-hidden="true" tabindex="-1" class="hash-link" href="#getting-started-with-code-generation-node-template" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-1"></a>Step 1<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-1" title="Direct link to heading">#</a></h3><p> Make a directory with any name and <code>cd</code> into it. Once you are in the directory run :
<code>npx bee-bootstrap node</code> </p><p>Name the following : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Service name (destination-basic): budget</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Service route (destinations): budget</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Service port (9000):9000 </span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-2"></a>Step 2<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-2" title="Direct link to heading">#</a></h3><p>At this point you should see a folder in your directory with the service name you just created. In our case this folder is called <code>budget</code>. If you <code>cd</code> into that folder you will see a <code>src</code> folder, a dockerfile , a package.json, and a README.md file :  </p><p><img alt="img" src="/assets/images/wkshp2-1948d4f8984778a948adbf19da505f65.png"></p><p><code>cd</code> into <code>budget</code> and run <code>yarn</code> </p><blockquote><p> Make sure you are using Node version 12.0.0 if not you can install with <code>nvm install v12.0.0</code></p></blockquote><p>You should see : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">yarn install v1.22.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">info No lockfile found.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[1/4] üîç  Resolving packages...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[2/4] üöö  Fetching packages...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[3/4] üîó  Linking dependencies...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[4/4] üî®  Building fresh packages...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">success Saved lockfile.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">‚ú®  Done in 9.64s.</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-3"></a>Step 3<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-3" title="Direct link to heading">#</a></h3><p>Run <code>yarn start</code> and you should see : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">yarn run v1.22.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ nodemon -r esm ./src/bin/www.js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] 2.0.6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] to restart at any time, enter `rs`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] watching path(s): *.*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] watching extensions: js,mjs,json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] starting `node -r esm ./src/bin/www.js`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">‚ú® You&#x27;ve saved 6 lines of extra YAML (‚ñº 24.0%)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Listening on port 9000</span></div></div></div></div></div><p>Now go to <code>http://localhost:9000/api-docs/</code></p><p>You should see the service up and running</p><p><img alt="img" src="/assets/images/wkshp3-468f7ee46c596832b5f71ce91b9e170e.png"></p><p>Congrats you have the Node Service template up and running! Lets get started with building the budget microservice. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="building-a-budget-microservice"></a>Building a Budget Microservice<a aria-hidden="true" tabindex="-1" class="hash-link" href="#building-a-budget-microservice" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-1-1"></a>Step 1<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-1-1" title="Direct link to heading">#</a></h3><p>Our budget service api will be taking in data such as : </p><ul><li>city</li><li>country</li><li>date from (arriving date)</li><li>date to (departing date)</li><li>max cost </li></ul><p>We need to create a GET request api endpoint that requires this information </p><p>In <code>budget &gt; src &gt; routes</code> you will see a file called <code>budget.js</code> This is the file where we will be creating our GET request api. </p><p>The api endpoint of this file will be <code>/api/v1/budget/{country}/{city}</code> </p><p>You can replace all the code in this file with this <a href="https://github.com/pmmistry/bee-travels-workshop/blob/main/budget-v1/src/routes/budget.js" target="_blank" rel="noopener noreferrer">budget.js code</a> </p><p>The GET request is the main aspect of this code that is created to set up the data that will be required by this API</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * GET /api/v1/budget/{country}/{city}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @tag Budget</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @summary Get list of hotels and car rentals that fit a budget</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @description Gets data for hotel and cars associated with a specific city and budget.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @pathParam {string} country - Country of the hotel using slug casing.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @pathParam {string} city - City of the hotel using slug casing.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @queryParam {string} dateFrom - Date From</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @queryParam {string} dateTo - Date To</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @queryParam {number} maxcost - Max Cost.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @response 200 - OK</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> * @response 500 - Internal Server Error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">router.get(&quot;/:country/:city&quot;, async (req, res, next) =&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // const context = new Jaeger(&quot;city&quot;, req, res);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const { country, city } = req.params;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    maxcost,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dateFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dateTo,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  } = req.query;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  req.log.info(`getting budget data for -&gt; /${country}/${city}`);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  try {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    const data = await breaker.fire(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      country,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      city,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        maxCost: parseInt(maxcost, 10) || undefined,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        dateFrom: dateFrom || undefined,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        dateTo: dateTo|| undefined,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      context</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    res.json(data);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  } catch (e) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    console.log(e)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    next(e);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-2-1"></a>Step 2<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-2-1" title="Direct link to heading">#</a></h3><p>The budget service is dependent on the hotel microservice
and the car rental microservice. We will be creating a budget service that gives us both hotel and car data based on our max budget. </p><p>The first thing we need to do before we build our microservice is get both the hotel microservice and car microservice up and running </p><p><strong>Run Hotel Service</strong> </p><p>Make sure you have docker installed and in a seperate terminal window run the following commands : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull beetravels/hotel-v1:node-540d5182fe943a3ad87c559dd7fcce025cec9833</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -p 9101:9101 beetravels/hotel-v1:node-540d5182fe943a3ad87c559dd7fcce025cec9833</span></div></div></div></div></div><p>You should see : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">‚ú® You&#x27;ve saved 53 lines of extra YAML (‚ñº 54.6%)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Listening on port 9101</span></div></div></div></div></div><p>If you go to <code>http://localhost:9101/api-docs/</code> in your browser you should see your hotel service up and running. </p><p><img alt="img" src="/assets/images/wkshp4-1c19366a8abc2e89a0e13331bd188d6c.png"></p><p><strong>Run Car Service</strong> </p><p>Run the following commands in another terminal window to run the car service : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker pull beetravels/carrental-v1:node-540d5182fe943a3ad87c559dd7fcce025cec9833</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">docker run -p 9102:9102 beetravels/carrental-v1:node-540d5182fe943a3ad87c559dd7fcce025cec9833</span></div></div></div></div></div><p>You should see : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">‚ú® You&#x27;ve saved 57 lines of extra YAML (‚ñº 54.8%)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Listening on port 9102</span></div></div></div></div></div><p>If you go to <code>http://localhost:9102/api-docs/</code> in your browser you should see your car service up and running.</p><p><img alt="img" src="/assets/images/wkshp5-a074376c6fb1ccdaf3e3d876ac528259.png"></p><p>Now that you have both these services up and running you can call both hotel and car apis in your budget microservice </p><blockquote><p>Note : If you would like to kill your docker containers run <code>docker ps</code> to  locate the running containers and then run <code>docker kill &lt;CONTAINER ID&gt;</code> to kill any running containers </p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-3-1"></a>Step 3<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-3-1" title="Direct link to heading">#</a></h3><p>With both hotel and car microservices up and running we can now create a <code>hotel.js</code> file and a <code>car.js</code> file that individually calls on these apis to get both hotel and car data </p><p>In <code>budget &gt; src &gt; services</code> create a <code>hotel.js</code> file and then create a <code>car.js</code> file </p><p><strong>hotel.js file :</strong>  </p><p>Add this code to the <code>hotel.js</code> file to call the hotel microservice </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import axios from &quot;axios&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">const HOTEL_URL = process.env.HOTEL_URL || &quot;http://localhost:9101&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export async function getHotelData(country,city,dateFrom,dateTo) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const data = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dateFrom: dateFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dateTo: dateTo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const res = await axios.get(HOTEL_URL + `/api/v1/hotels/${country}/${city}`, {params:data});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return res.data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export async function hotelReadinessCheck() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const isReady = await axios.get(HOTEL_URL + &quot;/ready&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return isReady;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><p>Notice that you are calling the hotel api with the country and city end point. You can use the <a href="https://github.com/pmmistry/bee-travels-workshop/blob/main/budget-v1/src/services/hotel.js" target="_blank" rel="noopener noreferrer">hotel.js code</a> as a reference</p><p><strong>car.js file :</strong> </p><p>Add this code to the <code>car.js</code> file to call the car microservice : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import axios from &quot;axios&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">const CAR_URL = process.env.CAR_URL || &quot;http://localhost:9102&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export async function getCarData(country,city,dateFrom,dateTo) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const data = {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dateFrom: dateFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dateTo: dateTo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const res = await axios.get(CAR_URL + `/api/v1/cars/${country}/${city}`, {params:data});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return res.data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export async function carReadinessCheck() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const isReady = await axios.get(CAR_URL + &quot;/ready&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return isReady;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>You can use the <a href="https://github.com/pmmistry/bee-travels-workshop/blob/main/budget-v1/src/services/car.js" target="_blank" rel="noopener noreferrer">car.js code</a> as a reference</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-4"></a>Step 4<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-4" title="Direct link to heading">#</a></h3><p>Now that we have created both hotel.js and car.js files we are going to be adding some code to the <code>budget &gt; src &gt; services</code> <code>dataHandler.js</code> file </p><p>In this file we will be creating a function that does 5 steps</p><ol><li>Makes sure date range is valid </li><li>Calls the hotel service api end point</li><li>Calls the car service api end point</li><li>Finds car and hotel based on max price , date range and location</li><li>Return a list of hotel and car data combinations based on max price, date range and location</li></ol><p>You can replace all the code in the dataHandler.js file with this <a href="https://github.com/pmmistry/bee-travels-workshop/blob/main/budget-v1/src/services/dataHandler.js" target="_blank" rel="noopener noreferrer">dataHandler.js code</a></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import IllegalDateError from &quot;../errors/IllegalDateError&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import { getHotelData, hotelReadinessCheck } from &quot;./hotel&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import { getCarData, carReadinessCheck } from &quot;./car&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export async function getData(country, city, filters, context) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// step 1: Makes sure date range is valid</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  const {maxCost} = filters;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (parseDate(filters.dateTo) - parseDate(filters.dateFrom) &lt; 0) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    throw new IllegalDateError(&quot;from date can not be greater than to date&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// step 2 : Calls the hotel service api end point </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">const hotelData = await getHotelData(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  country,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  city,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  filters.dateFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  filters.dateTo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// step 3 : Calls the car service api end point </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">const carData = await getCarData(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  country,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  city,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  filters.dateFrom,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  filters.dateTo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// step 4 : Finds car and hotel based on max price , date range and location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let results = [];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let hotelIndex;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let carIndex;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let budgetOutput;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">for (hotelIndex = 0; hotelIndex &lt; hotelData.length; hotelIndex ++){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if(hotelData[hotelIndex].cost &lt;= maxCost){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    for(carIndex = 0; carIndex &lt; carData.length; carIndex ++){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      budgetOutput  = hotelData[hotelIndex].cost + carData[carIndex].cost;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if(budgetOutput &lt;= maxCost){</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        results.push({hotel:{id:hotelData[hotelIndex].id,name:hotelData[hotelIndex].name},</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        car:{id:carData[carIndex].id,name:carData[carIndex].name},cost:budgetOutput});</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  } </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// step 5 : Return a list of hotel and car data combinations based on max price, date range and location</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> return results</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function parseDate(date) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return Date.parse(date);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export async function readinessCheck() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-5"></a>Step 5<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-5" title="Direct link to heading">#</a></h3><p>In the <code>budget &gt; src &gt; errors</code> folder create a file called <code>IllegalDateError.js</code> to flag any errors with incorrect date format. </p><p>Add the following code or refer to <a href="https://github.com/pmmistry/bee-travels-workshop/blob/main/budget-v1/src/errors/IllegalDateError.js" target="_blank" rel="noopener noreferrer">IllegalDateError.js</a></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">class IllegalDateError extends Error {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  constructor(date) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    super(`Date not legal ${date}`);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Ensure the name of this error is the same as the class name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.name = this.constructor.name;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // This clips the constructor invocation from the stack trace.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // It&#x27;s not absolutely essential, but it does make the stack trace a little nicer.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Error.captureStackTrace(this, this.constructor);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">export default IllegalDateError;</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="step-6"></a>Step 6<a aria-hidden="true" tabindex="-1" class="hash-link" href="#step-6" title="Direct link to heading">#</a></h3><p>Once you have these files set up and you have completed all previous steps you are now ready to run the application </p><p>Run <code>yarn start</code> </p><p>You should see : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">yarn run v1.22.5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ nodemon -r esm ./src/bin/www.js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] 2.0.6</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] to restart at any time, enter `rs`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] watching path(s): *.*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] watching extensions: js,mjs,json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[nodemon] starting `node -r esm ./src/bin/www.js`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">‚ú® You&#x27;ve saved 33 lines of extra YAML (‚ñº 55.9%)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Listening on port 9000</span></div></div></div></div></div><p>If you go to <code>http://localhost:9000/api-docs/</code> you should see the
‚Äã<code>/api‚Äã/v1‚Äã/budget‚Äã/{country}‚Äã/{city}</code> api end point.</p><p>Click on the <code>Try it out</code> button to try out the service with the required parameters - for example : </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">country : united-states</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">city : new-york</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dateFrom : 2020-11-20  (Use this format for a date in the future)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">dateTo : 2020-11-30 (Use this format for a date in the future from dateFrom)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">maxcost : 1500</span></div></div></div></div></div><p><img alt="img" src="/assets/images/wkshp7-316386cb8ef6a8a4358e72873dd69155.png"></p><p>Click on the <code>Execute</code> button you should see the following output : </p><blockquote><p>Note : This might take some time to run</p></blockquote><p><img alt="img" src="/assets/images/wkshp6-613bff42dfaa39943d4f59a25fdda030.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="congratulations"></a>Congratulations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#congratulations" title="Direct link to heading">#</a></h3><p>Congrats on creating the budget microservice! You can now consider deploying this application. </p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-11-18T20:46:48.000Z" class="docLastUpdatedAt_217_">11/18/2020</time> by <strong>Pooja</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about" class="table-of-contents__link">About</a></li><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#getting-started-with-code-generation-node-template" class="table-of-contents__link">Getting Started with Code Generation Node Template</a><ul><li><a href="#step-1" class="table-of-contents__link">Step 1</a></li><li><a href="#step-2" class="table-of-contents__link">Step 2</a></li><li><a href="#step-3" class="table-of-contents__link">Step 3</a></li></ul></li><li><a href="#building-a-budget-microservice" class="table-of-contents__link">Building a Budget Microservice</a><ul><li><a href="#step-1-1" class="table-of-contents__link">Step 1</a></li><li><a href="#step-2-1" class="table-of-contents__link">Step 2</a></li><li><a href="#step-3-1" class="table-of-contents__link">Step 3</a></li><li><a href="#step-4" class="table-of-contents__link">Step 4</a></li><li><a href="#step-5" class="table-of-contents__link">Step 5</a></li><li><a href="#step-6" class="table-of-contents__link">Step 6</a></li><li><a href="#congratulations" class="table-of-contents__link">Congratulations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Introduction</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://developer.ibm.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">IBM Developer</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.crowdcast.io/ibmdeveloper" target="_blank" rel="noopener noreferrer" class="footer__link-item">Crowdcast</a></li></ul></div></div><div class="text--center"><div></div></div></div></footer></div>
<script src="/styles.bd6c5aa5.js"></script>
<script src="/runtime~main.358f0183.js"></script>
<script src="/main.6428835f.js"></script>
<script src="/1.f6070e50.js"></script>
<script src="/2.156073dc.js"></script>
<script src="/23.e9f77d1b.js"></script>
<script src="/24.05bc3b70.js"></script>
<script src="/a95e0901.d062a689.js"></script>
<script src="/17896441.08175231.js"></script>
<script src="/7b70a777.8f0ac477.js"></script>
</body>
</html>